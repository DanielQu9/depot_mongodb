<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <title>é€²å‡ºè²¨è¼¸å…¥</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <div class="container mt-4">
    <h2>ğŸ“¦ æ‰¹é‡é€²å‡ºè²¨è¼¸å…¥</h2>

    <!-- è¼¸å…¥è¡¨å–® -->
    <div class="row g-2 align-items-center">
      <div class="col-auto">
        <label class="form-label">é¡å‹ï¼š</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="type" value="in" id="typeIn" checked>
          <label class="form-check-label" for="typeIn">é€²è²¨</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="type" value="out" id="typeOut">
          <label class="form-check-label" for="typeOut">å‡ºè²¨</label>
        </div>
      </div>

      <div class="col-auto">
        <label class="form-label">å“é …ï¼š</label>
        <input list="itemList" id="itemInput" class="form-control" placeholder="è¼¸å…¥æˆ–é¸æ“‡å“é …">
        <datalist id="itemList">
          {% for name in items %}
          <option value="{{ name }}">
            {% endfor %}
        </datalist>
      </div>

      <div class="col-auto">
        <label class="form-label">æ•¸é‡ï¼š</label>
        <input type="number" id="amountInput" class="form-control" placeholder="æ•¸é‡" min="1">
      </div>

      <div class="col-auto mt-4">
        <button class="btn btn-secondary" onclick="addRecord()">åŠ å…¥æš«å­˜</button>
      </div>
    </div>

    <!-- æš«å­˜å€ -->
    <div class="mt-4">
      <h5>ğŸ“ æš«å­˜é …ç›®ï¼š</h5>
      <table class="table table-striped" id="tempTable">
        <thead>
          <tr>
            <th>é¡å‹</th>
            <th>å“é …</th>
            <th>æ•¸é‡</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <!-- å‹•æ…‹ç”¢ç”Ÿ -->
        </tbody>
      </table>
    </div>

    <button class="btn btn-success" onclick="submitRecords()">âœ… ç¢ºèªé€å‡º</button>
  </div>

  <script>
    const tempData = [];

    function addRecord() {
      const type = document.querySelector('input[name="type"]:checked').value;
      const item = document.getElementById('itemInput').value.trim();
      const amount = parseInt(document.getElementById('amountInput').value, 10);

      if (!item || !amount || amount <= 0) {
        alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„å“é …èˆ‡æ•¸é‡");
        return;
      }

      tempData.push({ type, item, amount });
      renderTable();
      document.getElementById('itemInput').value = '';
      document.getElementById('amountInput').value = '';
    }

    function removeRecord(index) {
      tempData.splice(index, 1);
      renderTable();
    }

    function renderTable() {
      const tbody = document.querySelector('#tempTable tbody');
      tbody.innerHTML = "";
      tempData.forEach((rec, i) => {
        const row = `
          <tr>
            <td>${rec.type === 'in' ? 'é€²è²¨' : 'å‡ºè²¨'}</td>
            <td>${rec.item}</td>
            <td>${rec.amount}</td>
            <td><button class="btn btn-sm btn-danger" onclick="removeRecord(${i})">ç§»é™¤</button></td>
          </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
      });
    }

    async function submitRecords() {
      if (tempData.length === 0) {
        alert("æš«å­˜é …ç›®ç‚ºç©ºï¼");
        return;
      }

      const res = await fetch('/stock/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(tempData)
      });

      const result = await res.json();
      if (result.status === "success") {
        alert(`æˆåŠŸé€å‡ºï¼, ${result.message} `);
      } else {
        alert(`é€å‡ºå¤±æ•—ï¼, ${result.message}`);
      }
      tempData.length = 0;
      renderTable();
    }
  </script>
</body>

</html>